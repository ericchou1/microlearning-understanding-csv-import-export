<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chapter 2: Making Sense of Chaos | The CSV Chronicles</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Custom Styles -->
    <link rel="stylesheet" href="../assets/css/styles.css">
    
    <!-- Prism.js for syntax highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
</head>
<body class="min-h-screen">
    <!-- Navigation -->
    <nav class="bg-slate-900/80 backdrop-blur-sm sticky top-0 z-50 border-b border-slate-800">
        <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
            <a href="../index.html" class="flex items-center gap-2 text-slate-300 hover:text-white">
                <span>üìä</span>
                <span class="font-bold">The CSV Chronicles</span>
            </a>
            <div class="flex items-center gap-4">
                <a href="chapter-1.html" class="text-slate-400 hover:text-slate-300 text-sm">‚Üê Prev</a>
                <span class="text-slate-500 text-sm">Chapter 2 of 5</span>
                <a href="chapter-3.html" class="text-blue-400 hover:text-blue-300 text-sm">Next ‚Üí</a>
            </div>
        </div>
    </nav>

    <!-- Chapter Title Card -->
    <div class="chapter-title-card mx-4 mt-8 md:mx-auto md:max-w-4xl">
        <div class="chapter-number">CHAPTER TWO</div>
        <h1>Making Sense of Chaos</h1>
        <p class="subtitle">In which our hero learns to read, validate, and understand the data</p>
    </div>

    <!-- Story Content -->
    <main class="max-w-5xl mx-auto px-4 py-8">
        
        <!-- Opening Scene -->
        <div class="comic-page">
            <div class="narrator-box mb-6">
                The next morning. Alex arrives early, armed with coffee and determination...
            </div>
            
            <div class="comic-row cols-2">
                <div class="panel">
                    <div class="panel-scene flex-col">
                        <span class="text-5xl mb-2">‚òï</span>
                    </div>
                    <div class="character">
                        <div class="character-avatar">üë®‚Äçüíª</div>
                        <div>
                            <div class="character-name text-sm">Alex</div>
                        </div>
                    </div>
                    <div class="thought-bubble">
                        Yesterday I learned to read CSVs. Today, I need to actually understand what's in them...
                    </div>
                </div>
                
                <div class="panel chaos">
                    <div class="narrator-box warning mb-4">
                        But the data had other plans...
                    </div>
                    <div class="code-panel">
                        <div class="code-panel-header">
                            <div class="dots">
                                <div class="dot red"></div>
                                <div class="dot yellow"></div>
                                <div class="dot green"></div>
                            </div>
                            <span class="filename">devices_old.csv</span>
                        </div>
                        <pre><code class="language-text">hostname,ip,type,loc
sw01,10.0.1.1,switch,Bldg A
,10.0.1.2,switch,
ROUTER-CORE,10.0.0.1,rtr,DC
fw-main,NOT_ASSIGNED,firewall,DC
switch-03,10.0.1.3,Switch,Building A</code></pre>
                    </div>
                    <div class="sfx text-center mt-3">YIKES!</div>
                </div>
            </div>
            
            <!-- Problem Discovery -->
            <div class="comic-row cols-1 mt-6">
                <div class="panel">
                    <div class="character">
                        <div class="character-avatar">üë®‚Äçüíª</div>
                        <div>
                            <div class="character-name text-sm">Alex</div>
                        </div>
                    </div>
                    <div class="shout-bubble mx-auto">
                        THE DATA IS A MESS!
                    </div>
                    
                    <div class="grid md:grid-cols-2 gap-4 mt-6">
                        <div class="bg-red-900/30 border border-red-500/50 rounded-lg p-4">
                            <h4 class="font-bold text-red-400 mb-2">üö® Problems Found:</h4>
                            <ul class="text-sm text-slate-300 space-y-1">
                                <li>‚Ä¢ Missing hostnames</li>
                                <li>‚Ä¢ Empty location fields</li>
                                <li>‚Ä¢ Inconsistent type names (rtr vs router)</li>
                                <li>‚Ä¢ Invalid IP addresses</li>
                                <li>‚Ä¢ Inconsistent capitalization</li>
                            </ul>
                        </div>
                        <div class="bg-emerald-900/30 border border-emerald-500/50 rounded-lg p-4">
                            <h4 class="font-bold text-emerald-400 mb-2">‚úÖ Alex's Plan:</h4>
                            <ul class="text-sm text-slate-300 space-y-1">
                                <li>1. Read and inspect the data</li>
                                <li>2. Validate each field</li>
                                <li>3. Clean and normalize values</li>
                                <li>4. Report errors for manual review</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Learning Section: Reading with Validation -->
        <section class="mt-12">
            <h2 class="comic-title text-3xl text-center mb-8">üìö Reading CSVs with Validation</h2>
            
            <div class="panel mb-6">
                <h3 class="text-xl font-bold text-blue-400 mb-4">Step 1: Inspect the Data First</h3>
                
                <p class="text-slate-300 mb-4">
                    Before processing, Alex writes a script to understand the data:
                </p>
                
                <div class="code-panel">
                    <div class="code-panel-header">
                        <div class="dots">
                            <div class="dot red"></div>
                            <div class="dot yellow"></div>
                            <div class="dot green"></div>
                        </div>
                        <span class="filename">inspect_csv.py</span>
                    </div>
                    <pre><code class="language-python">import csv

def inspect_csv(filename: str) -> None:
    """Inspect a CSV file and report its structure."""
    with open(filename, 'r') as file:
        reader = csv.DictReader(file)
        
        # Get the column names
        print(f"üìã Columns: {reader.fieldnames}")
        
        # Count rows and check for issues
        row_count = 0
        empty_fields = {field: 0 for field in reader.fieldnames}
        
        for row in reader:
            row_count += 1
            for field, value in row.items():
                if not value or value.strip() == '':
                    empty_fields[field] += 1
        
        print(f"üìä Total rows: {row_count}")
        print(f"‚ö†Ô∏è  Empty fields:")
        for field, count in empty_fields.items():
            if count > 0:
                print(f"   - {field}: {count} empty")

# Run inspection
inspect_csv('devices_old.csv')</code></pre>
                </div>
                
                <div class="code-panel mt-4">
                    <div class="code-panel-header">
                        <div class="dots">
                            <div class="dot red"></div>
                            <div class="dot yellow"></div>
                            <div class="dot green"></div>
                        </div>
                        <span class="filename">Output</span>
                    </div>
                    <pre><code class="language-text">üìã Columns: ['hostname', 'ip', 'type', 'loc']
üìä Total rows: 5
‚ö†Ô∏è  Empty fields:
   - hostname: 1 empty
   - loc: 1 empty</code></pre>
                </div>
            </div>
            
            <!-- Validation Functions -->
            <div class="panel mb-6">
                <h3 class="text-xl font-bold text-amber-400 mb-4">Step 2: Create Validation Functions</h3>
                
                <p class="text-slate-300 mb-4">
                    Alex creates helper functions to validate each type of field:
                </p>
                
                <div class="code-panel">
                    <div class="code-panel-header">
                        <div class="dots">
                            <div class="dot red"></div>
                            <div class="dot yellow"></div>
                            <div class="dot green"></div>
                        </div>
                        <span class="filename">validators.py</span>
                    </div>
                    <pre><code class="language-python">import re

def is_valid_hostname(hostname: str) -> bool:
    """Check if hostname is valid (not empty, alphanumeric with dashes)."""
    if not hostname or not hostname.strip():
        return False
    # Hostname pattern: letters, numbers, dashes
    pattern = r'^[a-zA-Z0-9][a-zA-Z0-9\-]*[a-zA-Z0-9]$|^[a-zA-Z0-9]$'
    return bool(re.match(pattern, hostname))

def is_valid_ip(ip_address: str) -> bool:
    """Check if IP address is valid IPv4 format."""
    if not ip_address or not ip_address.strip():
        return False
    # Simple IPv4 pattern
    pattern = r'^(\d{1,3}\.){3}\d{1,3}$'
    if not re.match(pattern, ip_address):
        return False
    # Check each octet is 0-255
    octets = ip_address.split('.')
    return all(0 <= int(octet) <= 255 for octet in octets)

def normalize_device_type(device_type: str) -> str:
    """Normalize device type to standard values."""
    type_mapping = {
        'sw': 'switch',
        'switch': 'switch',
        'rtr': 'router',
        'router': 'router',
        'fw': 'firewall',
        'firewall': 'firewall',
    }
    normalized = device_type.lower().strip()
    return type_mapping.get(normalized, normalized)

# Test the validators
print(is_valid_hostname("switch-01"))  # True
print(is_valid_hostname(""))           # False
print(is_valid_ip("10.0.1.1"))         # True
print(is_valid_ip("NOT_ASSIGNED"))     # False
print(normalize_device_type("rtr"))    # router</code></pre>
                </div>
            </div>
            
            <!-- Complete Validation Script -->
            <div class="panel mb-6">
                <h3 class="text-xl font-bold text-emerald-400 mb-4">Step 3: Process with Validation</h3>
                
                <p class="text-slate-300 mb-4">
                    Now Alex combines everything into a complete validation script:
                </p>
                
                <div class="code-panel">
                    <div class="code-panel-header">
                        <div class="dots">
                            <div class="dot red"></div>
                            <div class="dot yellow"></div>
                            <div class="dot green"></div>
                        </div>
                        <span class="filename">validate_devices.py</span>
                    </div>
                    <pre><code class="language-python">import csv
from dataclasses import dataclass
from typing import Optional

@dataclass
class ValidationResult:
    """Result of validating a single row."""
    row_number: int
    is_valid: bool
    errors: list[str]
    data: Optional[dict] = None

def validate_row(row_num: int, row: dict) -> ValidationResult:
    """Validate a single CSV row and return results."""
    errors = []
    
    # Check hostname
    hostname = row.get('hostname', '').strip()
    if not hostname:
        errors.append("Missing hostname")
    elif not is_valid_hostname(hostname):
        errors.append(f"Invalid hostname: {hostname}")
    
    # Check IP address
    ip = row.get('ip', '').strip()
    if not ip:
        errors.append("Missing IP address")
    elif not is_valid_ip(ip):
        errors.append(f"Invalid IP: {ip}")
    
    # Normalize device type
    device_type = normalize_device_type(row.get('type', ''))
    if not device_type:
        errors.append("Missing device type")
    
    # Check location
    location = row.get('loc', '').strip()
    if not location:
        errors.append("Missing location")
    
    return ValidationResult(
        row_number=row_num,
        is_valid=len(errors) == 0,
        errors=errors,
        data={
            'hostname': hostname.lower(),
            'ip_address': ip,
            'device_type': device_type,
            'location': location
        } if not errors else None
    )

def process_csv(filename: str) -> tuple[list[dict], list[ValidationResult]]:
    """Process CSV file, returning valid data and validation errors."""
    valid_devices = []
    all_results = []
    
    with open(filename, 'r') as file:
        reader = csv.DictReader(file)
        
        for row_num, row in enumerate(reader, start=2):  # Start at 2 (header is row 1)
            result = validate_row(row_num, row)
            all_results.append(result)
            
            if result.is_valid:
                valid_devices.append(result.data)
            else:
                print(f"‚ö†Ô∏è  Row {row_num}: {', '.join(result.errors)}")
    
    return valid_devices, all_results

# Run the processor
valid, results = process_csv('devices_old.csv')
print(f"\n‚úÖ Valid devices: {len(valid)}")
print(f"‚ùå Invalid rows: {len([r for r in results if not r.is_valid])}")</code></pre>
                </div>
            </div>
        </section>
        
        <!-- Alex's Progress Scene -->
        <section class="mt-12">
            <div class="comic-page">
                <div class="comic-row cols-2">
                    <div class="panel">
                        <div class="code-panel">
                            <div class="code-panel-header">
                                <div class="dots">
                                    <div class="dot red"></div>
                                    <div class="dot yellow"></div>
                                    <div class="dot green"></div>
                                </div>
                                <span class="filename">Terminal Output</span>
                            </div>
                            <pre><code class="language-text">$ python validate_devices.py
‚ö†Ô∏è  Row 3: Missing hostname, Missing location
‚ö†Ô∏è  Row 5: Invalid IP: NOT_ASSIGNED

‚úÖ Valid devices: 3
‚ùå Invalid rows: 2</code></pre>
                        </div>
                    </div>
                    
                    <div class="panel success">
                        <div class="character">
                            <div class="character-avatar">üë®‚Äçüíª</div>
                            <div>
                                <div class="character-name text-sm">Alex</div>
                            </div>
                        </div>
                        <div class="speech-bubble">
                            "Now I know exactly which rows have problems! I can fix them manually 
                            or flag them for review."
                        </div>
                        <div class="thought-bubble mt-4">
                            But I have 50 CSV files to process... I need to automate this further.
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Bonus: Pandas Section -->
        <section class="mt-12">
            <h2 class="comic-title text-3xl text-center mb-8">üêº Bonus: Power Up with Pandas</h2>
            
            <div class="panel featured mb-6">
                <div class="narrator-box mb-4">
                    A colleague stops by Alex's desk...
                </div>
                
                <div class="comic-row cols-2 gap-4">
                    <div>
                        <div class="character">
                            <div class="character-avatar" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">üë©‚Äçüíª</div>
                            <div>
                                <div class="character-name text-sm" style="color: #10b981;">Sam</div>
                                <div class="text-slate-500 text-xs">Data Analyst</div>
                            </div>
                        </div>
                        <div class="speech-bubble">
                            "Hey Alex! If you're dealing with lots of CSV files, you should try Pandas. 
                            It's a game-changer for data processing!"
                        </div>
                    </div>
                    <div>
                        <div class="character">
                            <div class="character-avatar">üë®‚Äçüíª</div>
                            <div>
                                <div class="character-name text-sm">Alex</div>
                            </div>
                        </div>
                        <div class="speech-bubble">
                            "Pandas? Like the bear?"
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="panel mb-6">
                <h3 class="text-xl font-bold text-purple-400 mb-4">Reading CSVs with Pandas</h3>
                
                <p class="text-slate-300 mb-4">
                    Pandas makes CSV handling incredibly powerful with just a few lines:
                </p>
                
                <div class="code-panel">
                    <div class="code-panel-header">
                        <div class="dots">
                            <div class="dot red"></div>
                            <div class="dot yellow"></div>
                            <div class="dot green"></div>
                        </div>
                        <span class="filename">pandas_example.py</span>
                    </div>
                    <pre><code class="language-python">import pandas as pd

# Read CSV into a DataFrame
df = pd.read_csv('devices_old.csv')

# Quick overview of the data
print(df.info())
print("\n" + "="*50 + "\n")

# Show first few rows
print(df.head())
print("\n" + "="*50 + "\n")

# Find rows with missing values
print("Rows with missing data:")
print(df[df.isnull().any(axis=1)])
print("\n" + "="*50 + "\n")

# Get unique values in a column
print(f"Device types found: {df['type'].unique()}")

# Filter data
switches = df[df['type'].str.lower().isin(['switch', 'sw'])]
print(f"\nFound {len(switches)} switches")</code></pre>
                </div>
                
                <div class="bg-purple-900/30 border border-purple-500/50 rounded-lg p-4 mt-4">
                    <h4 class="font-bold text-purple-400 mb-2">üêº Why Pandas?</h4>
                    <ul class="text-sm text-slate-300 space-y-1">
                        <li>‚Ä¢ Read/write CSVs in one line</li>
                        <li>‚Ä¢ Powerful filtering and querying</li>
                        <li>‚Ä¢ Handle missing data gracefully</li>
                        <li>‚Ä¢ Transform and clean data easily</li>
                        <li>‚Ä¢ Export to multiple formats</li>
                    </ul>
                </div>
            </div>
        </section>
        
        <!-- Key Takeaways -->
        <section class="mt-12">
            <div class="panel">
                <h3 class="comic-title text-2xl text-center mb-6">üìù Chapter 2 Key Takeaways</h3>
                
                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <h4 class="font-bold text-blue-400 mb-3">Data Validation</h4>
                        <ul class="space-y-2 text-slate-300 text-sm">
                            <li>‚úì Always inspect data before processing</li>
                            <li>‚úì Check for missing/empty values</li>
                            <li>‚úì Validate data formats (IP, hostname)</li>
                            <li>‚úì Normalize inconsistent values</li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-bold text-emerald-400 mb-3">Best Practices</h4>
                        <ul class="space-y-2 text-slate-300 text-sm">
                            <li>‚úì Create reusable validation functions</li>
                            <li>‚úì Report errors with row numbers</li>
                            <li>‚úì Separate valid from invalid data</li>
                            <li>‚úì Consider Pandas for complex tasks</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Try It Yourself -->
        <div class="try-it-section mt-12">
            <h3>üß™ Try It Yourself!</h3>
            <p class="text-slate-400 mb-4">
                Practice reading and validating CSV data with Python. 
                The exercise includes messy sample data to clean!
            </p>
            <a href="../exercises/exercise-2.py" class="exercise-link">
                <span>üìù</span>
                <span>Open Exercise 2</span>
            </a>
        </div>
        
        <!-- Chapter Navigation -->
        <div class="chapter-nav">
            <a href="chapter-1.html">
                <span>‚Üê</span>
                <span>Chapter 1</span>
            </a>
            <span class="text-slate-500">Chapter 2 of 5</span>
            <a href="chapter-3.html">
                <span>Chapter 3</span>
                <span>‚Üí</span>
            </a>
        </div>
    </main>
    
    <!-- Footer -->
    <footer class="py-8 px-4 border-t border-slate-800 mt-12">
        <div class="max-w-4xl mx-auto text-center text-slate-500">
            <p class="text-sm">
                <a href="../index.html" class="text-blue-400 hover:underline">The CSV Chronicles</a>
                ¬∑ A learning adventure for network engineers
            </p>
        </div>
    </footer>
    
    <!-- Prism.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
</body>
</html>

